import { ImageResponse } from 'next/og'
import { getAllPosts } from '@/lib/api'

export const runtime = 'nodejs'
export const size = { width: 1200, height: 630 }
export const contentType = 'image/png'

export default async function Image(props: { params: Promise<{ slug: string }> }) {
  const params = await props.params
  const slug = params.slug

  const posts = getAllPosts()
  const post = posts.find((p) => p.slug === slug)

  const ORANGE = '#FF6308'
  const bg = 'linear-gradient(180deg, #0b0b0b 0%, #141414 100%)'
  const title = post?.title || 'NextRows Article'
  const subtitle = post?.category ? post.category.replace('-', ' ') : 'NextRows Blog'
  const author = post?.author?.name || 'NextRows Team'

  return new ImageResponse(
    (
      <div
        style={{
          width: `${size.width}px`,
          height: `${size.height}px`,
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          backgroundImage: bg,
          position: 'relative',
          fontFamily:
            'ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial',
        }}
      >
        <div
          style={{
            position: 'absolute',
            top: '-15%',
            left: '-10%',
            width: 700,
            height: 700,
            borderRadius: 700,
            background: 'radial-gradient(closest-side, rgba(255,99,8,0.2), transparent 70%)',
          }}
        />
        <div
          style={{
            position: 'absolute',
            bottom: '-20%',
            right: '-10%',
            width: 560,
            height: 560,
            borderRadius: 560,
            background: 'radial-gradient(closest-side, rgba(255,99,8,0.13), transparent 70%)',
          }}
        />

        <div
          style={{
            position: 'absolute',
            width: 1400,
            height: 220,
            transform: 'rotate(-15deg)',
            background: `linear-gradient(90deg, ${ORANGE} 0%, #ff7e39 100%)`,
            opacity: 0.12,
          }}
        />

        <div
          style={{
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'flex-start',
            justifyContent: 'center',
            color: '#ffffff',
            padding: '56px 80px',
            borderRadius: 20,
            background: '#0d0d0d',
            border: '2px solid rgba(255,99,8,0.4)',
            maxWidth: 1060,
          }}
        >
          <div style={{ display: 'flex', alignItems: 'center', gap: 16, marginBottom: 18 }}>
            <div
              style={{
                width: 56,
                height: 56,
                borderRadius: 12,
                background: '#111111',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                border: '2px solid rgba(255,99,8,0.67)',
              }}
            >
              <svg width="36" height="40" viewBox="0 0 21 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clipPath="url(#clip0)">
                  <path d="M18.23 20.9103L17.5784 18.3497C18.0158 18.3139 18.3728 17.9916 18.3728 17.6245L19.0244 20.1851C19.0244 20.5522 18.6674 20.8745 18.23 20.9103Z" fill={ORANGE}/>
                  <path d="M3.21597 22.1726L2.55542 19.612L17.5694 18.3496L18.23 20.9102L3.21597 22.1726Z" fill={ORANGE}/>
                  <path d="M12.0529 17.4185C12.1511 17.7945 12.2404 18.1616 12.3386 18.5376C12.4635 19.0211 12.5885 19.5046 12.7135 19.988C12.7135 20.0686 12.6331 20.1402 12.5439 20.1402C12.5171 20.1402 12.4814 20.1402 12.4546 20.1223L11.803 17.5617C11.8298 17.5707 11.8655 17.5796 11.8922 17.5796C11.9726 17.5707 12.0529 17.508 12.0529 17.4185Z" fill="#fff"/>
                  <path d="M15.5521 16.3801C15.7842 16.3622 15.9895 16.2637 16.1413 16.1294C16.168 16.2189 16.1948 16.3353 16.2216 16.4249C16.2484 16.5233 16.2752 16.6487 16.3019 16.7382C16.3287 16.8367 16.3644 16.971 16.3823 17.0695C16.409 17.168 16.4448 17.3023 16.4715 17.4007C16.4983 17.4992 16.534 17.6335 16.5608 17.732C16.5876 17.8305 16.6233 17.9648 16.6411 18.0633C16.6679 18.1618 16.6947 18.2871 16.7215 18.3766C16.7482 18.4662 16.775 18.5826 16.8018 18.6721C16.6501 18.8064 16.4448 18.9049 16.2127 18.9228C16.0074 18.1797 15.7485 17.1501 15.5521 16.3801Z" fill="#fff"/>
                  <path d="M16.1412 16.1295C16.293 15.9952 16.3912 15.8072 16.3912 15.6191L17.0428 18.1798C17.0428 18.3678 16.9446 18.5468 16.7929 18.6901C16.5786 17.8395 16.3644 16.989 16.1412 16.1295Z" fill="#fff"/>
                  <path d="M12.7135 19.2449L12.0619 16.6753L15.5521 16.3799L16.2037 18.9495L12.7135 19.2449Z" fill="#fff"/>
                  <path d="M12.7135 19.988L12.053 17.4184L12.0619 16.6753L12.7135 19.2449V19.988Z" fill="#fff"/>
                  <path d="M2.43934 21.7164L1.78772 19.1558C1.85913 19.4512 2.18048 19.6482 2.56431 19.6124L3.21593 22.173C2.8321 22.2088 2.51075 22.0118 2.43934 21.7164Z" fill={ORANGE}/>
                  <path d="M1.78775 19.1558C1.77882 19.111 1.7699 19.0663 1.7699 19.0215L2.42152 21.5821C2.42152 21.6269 2.43044 21.6716 2.43937 21.7164C2.24299 20.9464 1.98413 19.9258 1.78775 19.1558Z" fill="#fff"/>
                  <path d="M1.40389 21.9846L0.752265 19.424C0.725487 19.3255 0.708252 19.2173 0.708252 19.1099L1.5651 21.5009C1.55618 21.6083 1.37711 21.8861 1.40389 21.9846Z" fill={ORANGE}/>
                  <path d="M10.1874 19.1197L9.53577 16.5591L11.7941 17.5618L12.4457 20.1225L10.1874 19.1197Z" fill="#fff"/>
                  <path d="M10.116 19.0391L9.46436 16.4785C9.47328 16.5143 9.50006 16.5412 9.53577 16.5591L10.1874 19.1197C10.1517 19.1018 10.1249 19.0749 10.116 19.0391Z" fill="#fff"/>
                  <path d="M12.7135 18.3318L12.0619 15.7712L15.2932 15.4937L15.9448 18.0632L12.7135 18.3318Z" fill={ORANGE}/>
                  <path d="M10.1159 19.039L9.46429 16.4784C9.44644 16.4247 9.47322 16.362 9.5357 16.3262L10.1873 18.8868C10.1248 18.9226 10.107 18.9853 10.1159 19.039Z" fill={ORANGE}/>
                  <path d="M12.7135 18.3321L12.0619 15.7714V15.0283L12.7224 17.5889L12.7135 18.3321Z" fill="#fff"/>
                  <path d="M12.0619 15.0283C12.0619 15.0194 12.0619 15.0104 12.0619 15.0015L12.7135 17.5621C12.7135 17.571 12.7135 17.58 12.7135 17.5889C12.5261 16.819 12.1601 15.8162 12.0619 15.0283Z" fill="#fff"/>
                  <path d="M10.1874 18.8781L9.53577 16.3174L11.803 14.9297L12.4547 17.4993L10.1874 18.8781Z" fill={ORANGE}/>
                  <path d="M12.0618 15.0012L12.7135 17.5618C12.6956 17.4991 12.6242 17.4544 12.5439 17.4633C12.5171 17.4633 12.4814 17.4723 12.4546 17.4902L11.803 14.9296C11.8298 14.9117 11.8655 14.9027 11.8922 14.9027C11.9726 14.8938 12.044 14.9296 12.0618 15.0012Z" fill={ORANGE}/>
                  <path d="M17.0427 18.1884L16.3911 15.6189L16.4 12.145L17.0517 14.7056L17.0427 18.1884Z" fill="#fff"/>
                  <path d="M16.4 12.1452C16.4 12.1094 16.4 12.0825 16.3911 12.0557L17.0427 14.6163C17.0517 14.6431 17.0517 14.679 17.0517 14.7058C16.8553 13.9358 16.4982 12.9331 16.4 12.1452Z" fill="#fff"/>
                  <path d="M15.9448 18.0634L15.2932 15.4938L15.3021 12.2349L15.9538 14.8044L15.9448 18.0634Z" fill={ORANGE}/>
                  <path d="M16.3912 12.0555L17.0428 14.6162C16.9892 14.4102 16.775 14.2759 16.5072 14.3028L15.8556 11.7422C16.1145 11.7153 16.3376 11.8496 16.3912 12.0555Z" fill={ORANGE}/>
                  <path d="M16.5072 14.3028C16.8107 14.276 17.0517 14.464 17.0517 14.7147L17.0428 18.1975C17.0428 18.5825 16.6679 18.9227 16.2037 18.9585L12.7135 19.254V19.9971C12.7135 20.0777 12.6332 20.1493 12.5439 20.1493C12.5171 20.1493 12.4814 20.1493 12.4547 20.1314L10.1963 19.1286C10.0892 19.0839 10.0892 18.9585 10.1963 18.8869L12.4636 17.4991C12.4904 17.4812 12.5261 17.4723 12.5528 17.4723C12.6421 17.4633 12.7224 17.517 12.7224 17.5976V18.3407L15.9538 18.0721L15.9627 14.8132C15.9627 14.5535 16.2037 14.3297 16.5072 14.3028Z" fill={ORANGE}/>
                  <path d="M15.9537 14.8042L15.3021 12.2436C15.3021 11.9929 15.5521 11.769 15.8556 11.7422L16.5072 14.3028C16.2037 14.3297 15.9627 14.5535 15.9537 14.8042Z" fill={ORANGE}/>
                  <path d="M2.42152 21.582L1.7699 19.0214L1.78775 13.4883L2.43937 16.0579L2.42152 21.582Z" fill="#fff"/>
                  <path d="M3.23377 15.3328L2.58215 12.7632L3.93002 12.6558L4.58164 15.2164L3.23377 15.3328Z" fill="#fff"/>
                  <path d="M2.43934 16.0578L1.78772 13.4972C1.78772 13.1391 2.14477 12.8078 2.58216 12.772L3.23378 15.3326C2.79639 15.3684 2.43934 15.6907 2.43934 16.0578Z" fill="#fff"/>
                  <path d="M4.58167 15.2162L3.93005 12.6556C6.53653 12.4407 8.66099 10.5068 8.66991 8.34912L9.32153 10.9097C9.31261 13.0675 7.18815 15.0014 4.58167 15.2162Z" fill="#fff"/>
                  <path d="M18.4084 1.8667L19.0601 4.42731C19.069 4.47208 19.0779 4.51685 19.0779 4.56161L18.4263 2.001C18.4174 1.94728 18.4174 1.91147 18.4084 1.8667Z" fill={ORANGE}/>
                  <path d="M18.4084 1.86706L19.06 4.42768C18.9886 4.13222 18.6673 3.93525 18.2835 3.97106L17.6318 1.41045C18.0067 1.37463 18.3281 1.5716 18.4084 1.86706Z" fill="#fff"/>
                  <path d="M9.32156 10.9096L8.66101 8.349L8.68779 2.81592L9.33941 5.38549L9.32156 10.9096Z" fill="#fff"/>
                  <path d="M8.68779 2.75342C8.69672 2.78028 8.70564 2.80714 8.70564 2.82504C8.71457 2.8519 8.7235 2.87876 8.7235 2.90562C8.73242 2.93248 8.74135 2.95934 8.74135 2.9862C8.75027 3.01306 8.7592 3.04887 8.7592 3.06678C8.76813 3.09364 8.77705 3.12945 8.77705 3.14736C8.78598 3.17422 8.79491 3.20108 8.79491 3.22794C8.80383 3.2548 8.81276 3.28166 8.81276 3.30852C8.82168 3.32642 8.82168 3.36224 8.83061 3.38014C8.84846 3.45177 8.87524 3.5413 8.88417 3.60397C8.90202 3.6756 8.9288 3.77408 8.94665 3.84571C8.96451 3.91733 8.99128 4.01582 9.00914 4.0964C9.02699 4.16802 9.05377 4.27546 9.07162 4.34709C9.08947 4.41871 9.11625 4.52615 9.1341 4.59778C9.15196 4.6694 9.17874 4.76789 9.19659 4.84847C9.21444 4.92009 9.24122 5.01858 9.25907 5.0902C9.27693 5.16183 9.3037 5.25136 9.31263 5.31403C9.31263 5.33194 9.31263 5.3588 9.31263 5.37671L8.66101 2.81609C8.68779 2.79818 8.68779 2.77132 8.68779 2.75342Z" fill="#fff"/>
                  <path d="M10.1338 4.66017L9.48218 2.0906L17.6319 1.41016L18.2835 3.97077L10.1338 4.66017Z" fill="#fff"/>
                  <path d="M8.68774 2.75319C8.73238 2.42192 9.07157 2.12647 9.48218 2.09961L10.1338 4.66023C9.72319 4.69604 9.38399 4.98254 9.33936 5.31381C9.17869 4.66918 9.00909 4.0335 8.84842 3.38887C8.82164 3.28143 8.79486 3.17399 8.76808 3.06656C8.76808 3.0576 8.75915 3.0397 8.75915 3.02179C8.7413 2.94121 8.71452 2.86063 8.69667 2.78005C8.69667 2.7711 8.68774 2.76215 8.68774 2.75319Z" fill="#fff"/>
                  <path d="M18.2835 3.09359C19.31 3.00405 20.1312 3.62182 20.1312 4.47238L20.0777 20.0957C20.0777 20.9373 19.2386 21.6983 18.221 21.7879L3.21591 23.0503C2.19831 23.1398 1.36816 22.522 1.36816 21.6715L1.38602 16.1384C1.38602 15.2968 2.22509 14.5358 3.24269 14.4462L4.59056 14.3299C6.6079 14.1597 8.25926 12.6646 8.26819 10.9903L8.28604 5.45723C8.28604 4.61563 9.12511 3.85461 10.1427 3.76508L18.2835 3.09359ZM19.0244 20.1853L19.0779 4.56191C19.0779 4.20378 18.7209 3.93519 18.2835 3.971L10.1338 4.6604C9.69639 4.69621 9.33934 5.01852 9.33934 5.38561L9.32149 10.9097C9.31256 13.0675 7.18811 14.9924 4.58163 15.2162L3.23376 15.3326C2.79637 15.3684 2.43932 15.6907 2.43932 16.0578L2.42147 21.5909C2.42147 21.949 2.77852 22.2176 3.21591 22.1818L18.2299 20.9194C18.6673 20.8746 19.0244 20.5523 19.0244 20.1853Z" fill={ORANGE}/>
                  <path d="M18.2835 3.97107C18.7209 3.93526 19.078 4.1949 19.078 4.56198L19.0244 20.1853C19.0244 20.5435 18.6674 20.8747 18.23 20.9105L3.21595 22.1729C2.77856 22.2087 2.42151 21.9491 2.42151 21.582L2.43936 16.0489C2.43936 15.6908 2.79641 15.3595 3.2338 15.3237L4.58167 15.2073C7.18815 14.9925 9.31261 13.0586 9.32153 10.9009L9.33939 5.36777C9.33939 5.00964 9.69644 4.67838 10.1338 4.64256L18.2835 3.97107ZM17.0428 18.1888L17.0517 14.706C17.0517 14.4553 16.8107 14.2762 16.5072 14.2941C16.2037 14.321 15.9538 14.5448 15.9538 14.7955L15.9448 18.0545L12.7135 18.3231V17.5799C12.7135 17.4994 12.6332 17.4456 12.5439 17.4546C12.5171 17.4546 12.4814 17.4635 12.4547 17.4815L10.1874 18.8782C10.0803 18.9408 10.0803 19.0662 10.1874 19.1199L12.4457 20.1227C12.4725 20.1316 12.5082 20.1406 12.535 20.1406C12.6243 20.1316 12.7046 20.0689 12.7046 19.9884V19.2452L16.1948 18.9498C16.6679 18.914 17.0428 18.5737 17.0428 18.1888Z" fill="#fff"/>
                  <path d="M19.4441 1.5982L20.0928 4.14743C19.9177 3.47329 19.1713 3.02216 18.2836 3.09339L17.632 0.532772C18.5247 0.461147 19.2655 0.91776 19.4441 1.5982Z" fill={ORANGE}/>
                  <path d="M3.93017 11.778L4.58179 14.3386C6.60806 14.1685 8.57018 12.7059 8.57018 11.0316L8.58803 5.49877L8.76847 5.48764C8.77754 4.64613 9.1163 3.86328 10.1338 3.77376L9.808 2.49345L9.48219 1.21314C8.46459 1.30268 7.62552 2.0637 7.62552 2.9053L7.62559 2.90557L7.60774 8.43841L7.6078 8.43868C7.59875 10.1129 5.94743 11.6079 3.93017 11.778Z" fill={ORANGE}/>
                  <path d="M2.58216 11.8854L2.58463 11.895C1.56998 11.9872 0.73449 12.7467 0.73449 13.5865L1.38611 16.1472C1.38611 15.2966 2.21625 14.5445 3.24278 14.455L4.58165 14.3385L3.93003 11.7779L2.58216 11.8854Z" fill={ORANGE}/>
                  <path d="M0.707642 19.1107L1.35926 21.6714L1.76511 15.9797L0.725494 13.5777L0.707642 19.1107Z" fill={ORANGE}/>
                  <path d="M9.39011 3.91243L9.48219 1.21314L17.632 0.532772L18.2836 3.09339L9.39011 3.91243Z" fill={ORANGE}/>
                </g>
                <defs>
                  <clipPath id="clip0">
                    <rect width="19.4325" height="22.5352" fill="white" transform="translate(0.707642 0.523926)"/>
                  </clipPath>
                </defs>
              </svg>
            </div>

            <div style={{ display: 'flex', flexDirection: 'column' }}>
              <span style={{ fontSize: 28, opacity: 0.95 }}>NextRows Blog</span>
              <div
                style={{
                  marginTop: 4,
                  display: 'flex',
                  alignItems: 'center',
                  gap: 10,
                }}
              >
                <span
                  style={{
                    fontSize: 18,
                    letterSpacing: '0.2px',
                    color: '#d6d6d6',
                  }}
                >
                  {author}
                </span>
                <span style={{ width: 6, height: 6, borderRadius: 6, background: '#d6d6d6', opacity: 0.6 }} />
                <span
                  style={{
                    fontSize: 18,
                    letterSpacing: '0.2px',
                    color: '#d6d6d6',
                    textTransform: 'capitalize',
                  }}
                >
                  {subtitle}
                </span>
              </div>
            </div>
          </div>

          <h1
            style={{
              fontSize: 72,
              lineHeight: 1.1,
              fontWeight: 800,
              letterSpacing: '-0.02em',
              margin: 0,
              maxWidth: 980,
            }}
          >
            {title}
          </h1>

          <div style={{ marginTop: 26, display: 'flex', alignItems: 'center', gap: 12 }}>
            <div style={{ padding: '8px 14px', borderRadius: 999, background: 'rgba(255,99,8,0.10)', border: '1px solid rgba(255,99,8,0.4)', color: ORANGE, fontSize: 20, textTransform: 'capitalize' }}>
              {subtitle}
            </div>
            <span style={{ fontSize: 22, color: '#c8c8c8' }}>blog.nextrows.com</span>
          </div>
        </div>
      </div>
    ),
    {
      ...size,
    }
  )
}
